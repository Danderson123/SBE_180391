# Overview

This repository houses a Snakemake pipeline that maps read sets in FASTQ format to a reference assembly in FASTA format, then generates two consensus sequences using `samtools consensus` and `racon`. Diagnostic plots are then generated by re-mapping the reads to the consensus sequences.

# Quick start

The pipeline assumes that you are mapping reads to version 3 of the H37Rv *Mycobacterium tuberculosis* reference assembly. If you wish to change the reference assembly, scroll down to "Configuration". Place the FASTQ files that you want to map to the reference in `long_reads/` or `short_reads` if you are working with ONT reads or Illumina reads, respectively. The pipeline assumes that there are two FASTQ files for each Illumina sample, corresponding to deinterleaved paired-end reads.

If you installed the dependencies with conda, the pipeline can then be run with:

`make`

If you installed the dependencies with singularity, the pipeline can be run with:

`make singularity`

# Installation

Begin by cloning and cd-ing into the directory using:

`git clone https://github.com/Danderson123/SBE_180391 && cd SBE_180391`

## Conda

The required dependencies can be installed through conda using:

`make install`

or if you have [mamba](https://mamba.readthedocs.io/en/latest/installation/mamba-installation.html) installed:

`mamba env create -f environment.yaml`

## Singularity (preferred method)

This repository includes a recipe and pre-built [singularity]() container. If you have root access, pre-built container is available with each release and if you have root access, the container can be built with:

`make singularity-build`

# Configuration

The reference genome (in FASTA) format used to generate the consensus can be changed by modifying the value for `reference_FASTA` in `config.yaml` to the absolute path of the new reference FASTA.

The directory containing the long reads to be analysed can be modify by changing the value for `nanopore_directory` in `config.yaml` to the absolute path to the new directory.

The directory containing the short reads to be analysed can be modify by changing the value for `illumina_directory` in `config.yaml` to the absolute path to the new directory **NOTE: Illumina reads are assumed to be paired-end and deinterleaved**.
